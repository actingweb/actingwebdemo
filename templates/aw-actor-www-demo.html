<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
    <script>
        (function(){var t=localStorage.getItem('actingweb-theme');if(t&&t!=='system')document.documentElement.setAttribute('data-theme',t);else document.documentElement.removeAttribute('data-theme');})();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActingWeb Demo - API Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .demo-card {
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }
        .demo-card h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .demo-card p {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-bottom: 1rem;
        }
        .demo-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .demo-form input, .demo-form select, .demo-form textarea {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-family: inherit;
            background: var(--color-bg-primary);
        }
        .demo-form textarea {
            min-height: 80px;
            resize: vertical;
        }
        .demo-form label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--color-text-muted);
            margin-bottom: 0.25rem;
        }
        .demo-form .form-group {
            display: flex;
            flex-direction: column;
        }
        .result-box {
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-md);
            font-family: var(--font-mono);
            font-size: 0.75rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        .result-box.show {
            display: block;
        }
        .result-box.error {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }
        .result-box.success {
            background: var(--color-success-light);
            color: var(--color-success);
        }
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 2rem 0 0.5rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border);
        }
        .section-title:first-of-type {
            margin-top: 0;
        }
        .badge-method {
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge-method.post { background: var(--color-accent-light); color: var(--color-accent); }
        .badge-method.get { background: var(--color-success-light); color: var(--color-success); }
        .inline-inputs {
            display: flex;
            gap: 0.5rem;
        }
        .inline-inputs input {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="page-container" style="max-width: 1200px;">
        <div class="page-card animate-fade-in">
            <div class="page-header">
                <div class="page-icon page-icon-accent">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                    </svg>
                </div>
                <h1>API Explorer</h1>
                <p class="text-muted">Test ActingWeb hooks and endpoints interactively</p>
            </div>

            <div class="alert alert-info mb-lg" style="text-align: center;">
                <div style="margin-bottom: 0.5rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                    Use these forms to test the various ActingWeb hook endpoints.
                </div>
                <code id="baseUrl" style="font-size: 0.75rem; word-break: break-all;">{{ url }}</code>
            </div>

            <h2 class="section-title">Methods (RPC-Style Operations)</h2>
            <p class="text-muted text-sm mb-md">Methods are RPC-style calls that compute and return results. Per the ActingWeb spec, methods expose web service functionality.</p>

            <div class="demo-grid">
                <!-- Calculate Method -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/calculate</h3>
                    <p>Perform arithmetic operations</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/calculate', this)">
                        <div class="inline-inputs">
                            <div class="form-group">
                                <label>A</label>
                                <input type="number" name="a" value="10" required>
                            </div>
                            <div class="form-group">
                                <label>Operation</label>
                                <select name="operation">
                                    <option value="add">Add (+)</option>
                                    <option value="subtract">Subtract (-)</option>
                                    <option value="multiply">Multiply (*)</option>
                                    <option value="divide">Divide (/)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>B</label>
                                <input type="number" name="b" value="5" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Calculate</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Greet Method -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/greet</h3>
                    <p>Get a personalized greeting</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/greet', this)">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" name="name" value="World" placeholder="Enter name">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Greet</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Get Status Method -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/get_status</h3>
                    <p>Get actor status summary</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/get_status', this)">
                        <button type="submit" class="btn btn-primary btn-sm">Get Status</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Echo Method -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/echo</h3>
                    <p>Echo back any data (for testing)</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/echo', this)">
                        <div class="form-group">
                            <label>JSON Data</label>
                            <textarea name="_json">{"message": "Hello from ActingWeb!", "timestamp": "now"}</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Echo</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Search Method (MCP Tool) -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/search <span class="badge badge-accent">MCP</span></h3>
                    <p>Search actor properties (also available as MCP tool)</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/search', this)">
                        <div class="form-group">
                            <label>Query (use * for all)</label>
                            <input type="text" name="query" value="*" placeholder="Search term or *">
                        </div>
                        <div class="form-group">
                            <label>Limit</label>
                            <input type="number" name="limit" value="20" min="1" max="100">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Search</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Schedule Task Method (1X NEO Robot) -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /methods/schedule_task</h3>
                    <p>Schedule a task for 1X NEO robot</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/methods/schedule_task', this)">
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" name="description" value="Morning coffee preparation" placeholder="Task description">
                        </div>
                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea name="instructions" style="min-height: 60px;">Go to the kitchen, prepare a cup of coffee using the espresso machine, and bring it to the home office.</textarea>
                        </div>
                        <div class="form-group">
                            <label>Timestamp (ISO 8601)</label>
                            <input type="text" name="timestamp" value="2024-01-15T07:30:00Z" placeholder="2024-01-15T07:30:00Z">
                        </div>
                        <div class="form-group">
                            <label>Context (optional)</label>
                            <textarea name="context" style="min-height: 40px;">User prefers a double espresso with no sugar. Coffee beans are in the left cabinet.</textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Schedule Task</button>
                    </form>
                    <div class="result-box"></div>
                </div>
            </div>

            <h2 class="section-title">Actions (External Effects)</h2>
            <p class="text-muted text-sm mb-md">Actions trigger operations with external effects beyond state management, such as sending notifications or controlling external systems.</p>

            <div class="demo-grid">
                <!-- Log Message Action -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /actions/log_message</h3>
                    <p>Log a message at specified level</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/actions/log_message', this)">
                        <div class="form-group">
                            <label>Message</label>
                            <input type="text" name="message" value="Test message from UI" required>
                        </div>
                        <div class="form-group">
                            <label>Level</label>
                            <select name="level">
                                <option value="info">Info</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Log</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Send Notification Action -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /actions/send_notification</h3>
                    <p>Simulate sending a notification</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/actions/send_notification', this)">
                        <div class="form-group">
                            <label>Recipient</label>
                            <input type="text" name="recipient" value="demo@example.com" placeholder="user@example.com">
                        </div>
                        <div class="form-group">
                            <label>Message</label>
                            <input type="text" name="message" value="Hello from ActingWeb!" placeholder="Notification message">
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <select name="type">
                                <option value="email">Email</option>
                                <option value="sms">SMS</option>
                                <option value="push">Push</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Send</button>
                    </form>
                    <div class="result-box"></div>
                </div>
            </div>

            <h2 class="section-title">Callbacks (External Service Webhooks)</h2>
            <p class="text-muted text-sm mb-md">Callbacks are URLs you give to external services (email providers, SMS gateways, payment processors) so they can notify your actor of events.</p>

            <div class="demo-grid">
                <!-- Email Verification Callback -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /callbacks/email_verify</h3>
                    <p>Verify email address via token</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/callbacks/email_verify', this)">
                        <div class="form-group">
                            <label>Verification Token</label>
                            <input type="text" name="token" value="test-token-123" placeholder="Token from email link">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Verify</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- SMS Webhook Callback -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /callbacks/sms_webhook</h3>
                    <p>Receive incoming SMS (Twilio format)</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/callbacks/sms_webhook', this)">
                        <div class="form-group">
                            <label>From (phone number)</label>
                            <input type="text" name="From" value="+1234567890" placeholder="+1234567890">
                        </div>
                        <div class="form-group">
                            <label>Body (message)</label>
                            <input type="text" name="Body" value="Hello from SMS!" placeholder="SMS message content">
                        </div>
                        <div class="form-group">
                            <label>MessageSid</label>
                            <input type="text" name="MessageSid" value="SM123456789" placeholder="Twilio message ID">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Simulate SMS</button>
                    </form>
                    <div class="result-box"></div>
                </div>

                <!-- Payment Webhook Callback -->
                <div class="demo-card">
                    <h3><span class="badge-method post">POST</span> /callbacks/payment_webhook</h3>
                    <p>Handle payment events (Stripe format)</p>
                    <form class="demo-form" onsubmit="callEndpoint(event, '/{{ id }}/callbacks/payment_webhook', this)">
                        <div class="form-group">
                            <label>Event Type</label>
                            <select name="type">
                                <option value="payment_intent.succeeded">Payment Succeeded</option>
                                <option value="payment_intent.payment_failed">Payment Failed</option>
                                <option value="charge.refunded">Charge Refunded</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Simulate Event</button>
                    </form>
                    <div class="result-box"></div>
                </div>
            </div>

            <div class="flex gap-sm mt-xl">
                <a href="{{ url }}" class="btn btn-secondary flex-1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    Dashboard
                </a>
                <a href="{{ url }}/properties" class="btn btn-secondary flex-1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                        <line x1="7" y1="7" x2="7.01" y2="7"/>
                    </svg>
                    Properties
                </a>
            </div>

            <div class="mt-lg text-center text-xs text-muted">
                Powered by <a href="https://github.com/actingweb/actingweb">ActingWeb</a>
            </div>
        </div>
    </div>

    <script>
        // Set full base URL on page load (strip /www and everything after from current path)
        const actorPath = window.location.pathname.replace(/\/www.*$/, '');
        document.getElementById('baseUrl').textContent = window.location.origin + actorPath;

        async function callEndpoint(event, endpoint, form) {
            event.preventDefault();

            const resultBox = form.parentElement.querySelector('.result-box');
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;

            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Loading...';

            try {
                // Build request body from form
                const formData = new FormData(form);
                let body = {};

                // Check for raw JSON input
                const jsonField = formData.get('_json');
                if (jsonField && jsonField.trim()) {
                    try {
                        body = JSON.parse(jsonField);
                    } catch (e) {
                        body = { data: jsonField };
                    }
                } else {
                    // Convert form data to object
                    for (let [key, value] of formData.entries()) {
                        if (key !== '_json') {
                            // Try to parse numbers
                            if (!isNaN(value) && value !== '') {
                                body[key] = parseFloat(value);
                            } else {
                                body[key] = value;
                            }
                        }
                    }
                }

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',  // Include cookies for authentication
                    body: JSON.stringify(body)
                });

                const data = await response.json();

                resultBox.textContent = JSON.stringify(data, null, 2);
                resultBox.className = 'result-box show ' + (response.ok ? 'success' : 'error');
            } catch (error) {
                resultBox.textContent = 'Error: ' + error.message;
                resultBox.className = 'result-box show error';
            }

            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    </script>
</body>
</html>
